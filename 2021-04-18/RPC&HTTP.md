## HTTP调用 VS RPC调用
两种形式的C/S架构
- RPC主要是基于TCP/IP协议的（传输层）
- HTTP服务主要是基于HTTP协议的(应用层)

### OSI网络七层模型

在说RPC和HTTP的区别之前，我觉的有必要了解一下OSI的七层网络结构模型：
- 第一层：应用层。定义了用于在网络中进行通信和传输数据的接口；
- 第二层：表示层。定义不同的系统中数据的传输格式，编码和解码规范等；
- 第三层：会话层。管理用户的会话，控制用户间逻辑连接的建立和中断；
- 第四层：传输层。管理着网络中的端到端的数据传输；
- 第五层：网络层。定义网络设备间如何传输数据；
- 第六层：链路层。将上面的网络层的数据包封装成数据帧，便于物理层传输；
- 第七层：物理层。这一层主要就是传输这些二进制数据。

实际应用过程中，五层协议结构里面是没有表示层和会话层的，它们和应用层合并了。

### RPC服务
- RPC是远端过程调用，其调用协议通常包含传输协议和序列化协议。
- 从三个角度来介绍RPC服务：分别是RPC架构，同步异步调用以及流行的RPC框架。

##### RPC架构
一个完整的RPC架构里面包含了四个核心的组件，分别是Client ,Server,Client Stub以及Server Stub，这个Stub大家可以理解为存根。
- 客户端（Client），服务的调用方。
- 服务端（Server），真正的服务提供者。
- Client Stub，存放服务端的地址消息，再将客户端的请求参数打包成网络消息，然后通过网络远程发送给服务方。
- Server Stub，接收客户端发送过来的消息，将消息解包，并调用本地的方法。

##### RPC应用
RPC主要是用在大型企业里面，因为大型企业里面系统繁多，业务线复杂，而且**效率优势**非常重要的一块，这个时候RPC的优势就比较明显了。

比如我们有一个处理订单的系统服务，先声明它的所有的接口（这里就是具体指Java中的interface），然后将整个项目打包为一个jar包，服务端这边引入这个二方库，然后实现相应的功能，客户端这边也只需要引入这个二方库即可调用了。


##### RPC的优点
RPC框架一般使用长链接，不必每次通信都要3次握手，减少网络开销
RPC框架一般都有注册中心，有丰富的监控管理
发布、下线接口、动态扩展等，对调用方来说是无感知、统一化的操作
协议私密，安全性较高
rpc 协议更简单内容更小，效率更高
服务化架构、服务化治理，RPC框架是一个强力的支撑

### 同步调用与异步调用
- 什么是同步调用？同步调用就是客户端等待调用执行完成并返回结果。
- 什么是异步调用？异步调用就是客户端不等待调用执行完成返回结果，不过依然可以通过回调函数等接收到返回结果的通知。如果客户端并不关心结果，则可以变成一个单向的调用。
- 这个过程有点类似于Java中的callable和runnable接口，我们进行异步执行的时候，如果需要知道执行的结果，就可以使用callable接口，并且可以通过Future类获取到异步执行的结果信息。如果不关心执行的结果，直接使用runnable接口就可以了，因为它不返回结果，当然啦，callable也是可以的，我们不去获取Future就可以了。

###### 流行的RPC框架
目前流行的开源RPC框架还是比较多的。下面重点介绍三种：

- gRPC是Google公布的开源软件，基于最新的HTTP2.0协议，并支持常见的众多编程语言。这个RPC框架是基于HTTP协议实现的，底层使用到了Netty框架的支持。
- Thrift是Facebook的一个开源项目，主要是一个跨语言的服务开发框架。它有一个代码生成器来对它所定义的IDL定义文件自动生成服务代码框架。用户只要在其之前进行二次开发就行，对于底层的RPC通讯等都是透明的。
- Dubbo是阿里集团开源的一个RPC框架。协议和序列化框架都可以插拔是及其鲜明的特色。同样 的远程接口是基于Java Interface，并且依托于spring框架方便开发。可以方便的打包成单一文件，独立进程运行，和现在的微服务概念一致。


#### RPC VS HTTP服务 
- HTTP协议，以其中的Restful规范为代表，其优势很大。它可读性好，且可以得到防火墙的支持、跨语言的支持
- 但是对于大型企业来说，内部子系统较多、接口非常多的情况下，RPC框架的好处就显示出来了，首先就是长链接，不必每次通信都要像http一样去3次握手什么的，减少了网络开销；
- 其次就是RPC框架一般都有注册中心，有丰富的监控管理；发布、下线接口、动态扩展等，对调用方来说是无感知、统一化的操作。

#### 总结
RPC服务和HTTP服务还是存在很多的不同点的，一般来说，RPC服务主要是针对大型企业的，而HTTP服务主要是针对小企业的，因为RPC效率更高，而HTTP服务开发迭代会更快。