## 序列化协议
- 序列化： 将数据结构或对象转换成二进制串的过程
- 反序列化：将在序列化过程中所生成的二进制串转换成数据结构或者对象的过程
### 序列化协议特性
- 通用性
- 强健性/鲁棒性
- 可调试性/可读性
- 性能
- 可扩展性/兼容性
- 安全性/访问限制


### 序列化和反序列化的组件
- IDL（Interface description language）文件：参与通讯的各方需要对通讯的内容需要做相关的约定（Specifications）。为了建立一个与语言和平台无关的约定，这个约定需要采用与具体开发语言、平台无关的语言来进行描述。这种语言被称为接口描述语言（IDL），采用IDL撰写的协议约定称之为IDL文件。
- IDL Compiler：IDL文件中约定的内容为了在各语言和平台可见，需要有一个编译器，将IDL文件转换成各语言对应的动态库。
- Stub/Skeleton Lib：负责序列化和反序列化的工作代码。Stub是一段部署在分布式系统客户端的代码，一方面接收应用层的参数，并对其序列化后通过底层协议栈发送到服务端，另一方面接收服务端序列化后的结果数据，反序列化后交给客户端应用层；Skeleton部署在服务端，其功能与Stub相反，从传输层接收序列化参数，反序列化后交给服务端应用层，并将应用层的执行结果序列化后最终传送给客户端Stub。
- Client/Server：指的是应用层程序代码，他们面对的是IDL所生存的特定语言的class或struct。
- 底层协议栈和互联网：序列化之后的数据通过底层的传输层、网络层、链路层以及物理层协议转换成数字信号在互联网中传递。

### 序列化协议简介
XML、JSON、Protobuf、Thrift和Avro

#### 1. XML&SOAP
###### XML
- XML是一种常用的序列化和反序列化协议，具有跨机器，跨语言等优点。

###### SOAP（Simple Object Access protocol）
是一种被广泛应用的，基于XML为序列化和反序列化协议的结构化消息传递协议。
SOAP的解决方案一个特定的名称–Web service。
- 优点：安全、可扩展、跨语言、跨平台并支持多种传输层协议
- 缺点：XML的额外空间开销大，序列化之后的数据量剧增

#### 2. JSON（Javascript Object Notation）
采用”Attribute－value”的方式来描述对象

- 优点：简洁，可读，解析速度比较快
- 缺点：
    - 采用JSON进行序列化的额外空间开销比较大，对于大数据量服务或持久化，这意味着巨大的内存和磁盘开销，这种场景不适合。
    - 没有统一可用的IDL降低了对参与方的约束，实际操作中往往只能采用文档方式来进行约定，这可能会给调试带来一些不便，延长开发周期。
    - 由于JSON在一些语言中的序列化和反序列化需要采用反射机制，所以在性能要求为ms级别，不建议使用。

#### 3. Thrift
Thrift是Facebook开源提供的一个高性能，轻量级RPC服务框架，其产生正是为了满足当前大数据量、分布式、跨语言、跨平台数据通讯的需求。 但是，Thrift并不仅仅是序列化协议，而是一个RPC框架。
- 缺点：
    - Thrift的序列化被嵌入到Thrift框架里面，Thrift框架本身并没有透出序列化和反序列化接口，这导致其很难和其他传输层协议共同使用
    - Thrift序列化之后的数据是Binary数组，不具有可读性，调试代码时相对困难

#### 4. Protobuf
- 优点：
    - 1、标准的IDL和IDL编译器，这使得其对工程师非常友好。
    - 2、序列化数据非常简洁，紧凑，与XML相比，其序列化之后的数据量约为1/3到1/10。
    - 3、解析速度非常快，比对应的XML快约20-100倍。
    - 4、提供了非常友好的动态库，使用非常简介，反序列化只需要一行代码。
- 缺点：
    - Protobuf产生于Google，所以目前其仅仅支持Java、C++、Python三种语言
    - Protobuf支持的数据类型相对较少，不支持常量类型。

#### 5. Avro
Avro属于Apache Hadoop的一个子项目，Avro提供两种序列化格式：JSON格式或者Binary格式。
- 优点：
    - Avro支持的数据类型非常丰富
    - Avro支持JSON格式的IDL和类似于Thrift和Protobuf的IDL
    - 解决了JSON的冗长和没有IDL的问题


### 选型
五种序列化和反序列化协议都各自具有相应的特点，适用于不同的场景：

- 1、对于内部的系统调用，如果性能要求在100ms以上的服务，基于XML的SOAP协议是一个值得考虑的方案。
- 2、基于Web browser的Ajax，以及Mobile app与服务端之间的通讯，JSON协议是首选。对于性能要求不太高，或者以动态类型语言为主，或者传输数据载荷很小的的运用场景，JSON也是非常不错的选择。
- 3、对于调试环境比较恶劣的场景，采用JSON或XML能够极大的提高调试效率，降低系统开发成本。
- 4、当对性能和简洁性有极高要求的场景，Protobuf，Thrift，Avro之间具有一定的竞争关系。
- 5、对于T级别的数据的持久化应用场景，Protobuf和Avro是首要选择。如果持久化后的数据存储在Hadoop子项目里，Avro会是更好的选择。
- 6、由于Avro的设计理念偏向于动态类型语言，对于动态语言为主的应用场景，Avro是更好的选择。
- 7、对于持久层非Hadoop项目，以静态类型语言为主的应用场景，Protobuf会更符合静态类型语言工程师的开发习惯。
- 8、如果需要提供一个完整的RPC解决方案，Thrift是一个好的选择。
- 9、如果序列化之后需要支持不同的传输层协议，或者需要跨防火墙访问的高性能场景，Protobuf可以优先考虑。