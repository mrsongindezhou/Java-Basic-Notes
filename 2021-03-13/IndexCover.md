
## 如果一条sql命中了索引，它一定会走索引吗？
### 命中了索引，但未覆盖索引。

```
select * from s1 where id=123;
该sql命中了索引，但未覆盖索引。
```

- 利用id=123到索引的数据结构中定位到该id在硬盘中的位置，或者说再数据表中的位置。
- 但是我们select的字段为*，除了id以外还需要其他字段，这就意味着，我们通过索引结构取到id还不够，
- 还需要利用该id再去找到该id所在行的其他字段值，这是需要时间的
- 很明显，如果我们只select id，就减去了这份苦恼，如下

```
select id from s1 where id=123;
```

- 这条就是覆盖索引了，命中索引，且从索引的数据结构直接就取到了id在硬盘的地址，速度很快

## 索引覆盖

mysql的innodb中索引类型分为主键索引和二级索引（非主键索引）

- 主键索引树中，叶子结点保存着主键即对应行的全部数据；
    
```
通过主键索引，不需要回表：
执行语句(A): select id from user where username = 'aa'，
因为username索引树的叶子结点上保存有username和id的值，
所以通过username索引树查找到id后，我们就已经得到所需的数据了，
这时候就不需要再去主键索引上继续查找了。
```

- 二级索引树中，叶子结点保存着索引值和主键值，当使用二级索引进行查询时，需要进行回表操作。


```
执行语句(B) select password from user_table where username = 'aa'时，流程如下

1. username索引树上找到username=lzs对应的主键id
1. 通过回表在主键索引树上找到满足条件的数据
```

### 索引覆盖含义
覆盖索引： 
- 当sql语句的所求查询字段 **（select列）**和查询条件字段**（where子句**）全都包含在一个索引中，可以直接使用索引查询而不需要回表。
- 通过使用覆盖索引，可以减少搜索树的次数，是常用的性能优化手段。

优化方法：
- 上面的语句B是一个高频查询的语句，我们可以建立(username,password)的联合索引，这样，查询的时候就不需要再去回表操作了，可以提高查询效率。
- 添加索引是有维护代价的，所以添加时也要权衡一下。
