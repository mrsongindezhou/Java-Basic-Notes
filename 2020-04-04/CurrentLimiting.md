## 简述中间件削峰和限流的使用场景

### 削峰和限流的使用场景
在一些秒杀的业务场景中，因为短时间上亿的用户涌入，瞬间流量巨大（高并发），需要实现削峰和限流。

- 流量削峰：在开始的时候会有一个瞬间的流量峰值， 流量削峰是指把瞬间的流量峰值变得更平缓。

- 限流：因为活动的库存一般都很少，对应只有少部分用户才能秒杀成功。所以需要限制大部分的用户流量。


### 怎样来实现流量削峰方案
- 削峰从本质上来说就是更多地延缓用户请求，以及层层过滤用户的访问需求。
#### 1.消息队列解决削峰
- 用消息队列来缓冲瞬时流量，把同步的直接调用转换成异步的间接推送
- 中间通过一个队列在一端承接瞬时的流量洪峰，在另一端平滑地将消息推送出去。
##### 消息队列中间件
1. 实现消息队列的队列中间件主要解决应用耦合，异步消息， 流量削锋等问题。
1. 常用消息队列系统： RocketMQ、Kafka、RabbitMQ ZeroMQ、ActiveMQ、MetaMQ等。

#### 2.流量削峰漏斗：层层削峰
- 目的是对请求进行分层过滤，从而过滤掉一些无效的请求，遵从“最后落地到数据库的请求数要尽量少”的原则。
##### 分层过滤的核心思想

- 通过在不同的层次尽可能地过滤掉无效请求。
- 通过CDN过滤掉大量的图片，静态资源的请求。
- 再通过类似Redis这样的分布式缓存，过滤请求等就是典型的在上游拦截读请求。

### 怎样来实现限流方案
- 通过nginx限流，nginx本身有请求限制和流量限制模块，比如限制请求频率、单ip并发，ip白名单等；
- 在微服务场景下，通过Springcloud Gateway和Redis可以实现更复杂灵活的限流策略，通过配置网关过滤器可以限制每秒请求数，每秒最大请求数，还能根据请求参数或请求ip地址来达到限流作用。