## 什么是 SQL 注入攻击？如何防止这类攻击？

### 什么是 SQL 注入攻击？
SQL注入是比较常见的网络攻击方法，他不是操作系统的BUG来实现攻击，而是根据sql语句实现无账号登录，篡改数据库。

### SQL注入的步骤：
1. 寻找SQL注入的位置，
1. 判断服务器类型和后台的数据库类型
1. 针对不同的服务器类型和数据特点进行sql注入攻击。

### SQL注入的实例：
1. 登录sql这样写：


```
String sql= "select * from user_table where username="+username+"and password="+password;
```
 

2. 如果username="or 1=1--"sql语句会变成：


```
String sql= "select * from user_table where username=""or 1=1--and password="";
```

3. 因为1=1返回为true，而后面的--代表注释，所以这个sql语句一定会执行成功。

所以就会返回true；根据这个思路，若果是传入的drop 这一定是严重漏洞。

### SQL注入的解决方法：



1. 在jdbc可以使用带sql审计和sql防注入功能的驱动，使用白名单访问方法。
1. 在代码层，检查sql变量数据类型和格式,尽量避免变量中出现SQL语句。
1. 在领域model中的字段，对字符长度进行限制，同时校验格式是否正确。
1. 在函数的入口处，对所有的string参数做sql转义，在js输出时做反转义。如果实在需要使用sql的使用sqlparser分析生成的语法树是否符合预期值，是否包括不正常的关键字，使用白名单制。
1. 在web输入参数处，对所有的参数做sql转义，在js输出时做反向转义。
1. 在代码控制数据访问权限时，需要把数据访问权限代码专门归类或标注，对代码进行漏洞审计。
1. 上线测试，需要使用sql自动注入工具进行所有的页面sql注入测试，没有进行过sql注入测试的页面不进行业务功能测试和上线。
1. 在数据访问权限控制上使用白名单代替黑名单，对ID等主键设置为uuid的字符串型防止出现自增ID的顺序猜测。
1. 使用人工智能的用户访问行为分析系统，实现实时报警和侦察越权访问。
1. 实现多层次立体拦截：UI入口拦截，函数参数拦截，数据库驱动拦截，sql语法树白名单制，域模型字段规则拦截，DB权限拦截，代码分析拦截，访问日志分析拦截，行为分析系统拦截。

附加防护 - 在数据库层：
1. 需要使用多用户管理，分离用户权限，按最小用户权限限制。
1. 做好数据库服务器安全，使用防火墙，实现IP、mac地址访问限制
1. 使用不对称密钥加密连接，对表名加上随机前辍
1. 对用户名加上随机字符串前辍，对管理员使用证书连接，对前后台分离使用不同用户名，对前台可以使用多级用户，匿名用户使用最小权限无法拥有增删改权限，匿名用户只能访问公有数据表不能访问用户私有数据表（设计时需要分离，如用户密码、手机号分离存放在私有数据表中）。
